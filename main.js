(()=>{"use strict";var t,e=function(){function t(){this.editor=this.setAttributes(document.createElement("div"),{id:"editor"}),this.toolbar=this.setAttributes(document.createElement("div"),{id:"toolbar"}),this.textarea=this.setAttributes(document.createElement("textarea"),{id:"textarea"}),this.contextmenu=this.setAttributes(document.createElement("div"),{class:"context-menu"}),this.history=this.setAttributes(document.createElement("div"),{class:"history"})}return t.prototype.getHTMLElement=function(t){switch(t){case"editor":return this.editor;case"toolbar":return this.toolbar;case"textarea":return this.textarea;case"contextmenu":return this.contextmenu;case"history":return this.history;default:throw new Error("Element not found")}},t.prototype.setAttributes=function(t,e){for(var n=0,o=Object.entries(e);n<o.length;n++){var r=o[n],i=r[0],a=r[1];t.setAttribute(i,a)}return t},t}();!function(t){t[t.ClearCommand=0]="ClearCommand",t[t.UndoCommand=1]="UndoCommand",t[t.SaveCommand=2]="SaveCommand",t[t.CopyCommand=3]="CopyCommand",t[t.UpdateContentCommand=4]="UpdateContentCommand",t[t.RollbackAllCommand=5]="RollbackAllCommand",t[t.PasteCommand=6]="PasteCommand"}(t||(t={}));var n,o=function(){function n(t){this.subscribers=[],this.elementFactory=new e,this.createToolsUI(t)}return n.prototype.subscribe=function(t){this.subscribers.push(t)},n.prototype.createToolsUI=function(t){var e=this.elementFactory.getHTMLElement("toolbar");e.classList.add("toolbar"),this.createButtons(e),t.appendChild(e)},n.prototype.createButtons=function(e){e.appendChild(this.createButton("Rollback all",t.RollbackAllCommand)),e.appendChild(this.createButton("Copy",t.CopyCommand)),e.appendChild(this.createButton("Undo",t.UndoCommand)),e.appendChild(this.createButton("Clear",t.ClearCommand))},n.prototype.createButton=function(t,e){var n=this,o=document.createElement("button");return o.classList.add("toolbar__action"),o.setAttribute("data-action",e.toString()),o.innerText=t,o.addEventListener("click",(function(){n.subscribers.forEach((function(t){return t(e)}))})),o},n}(),r=function(){function t(t){this.subscribers=[],this.elementFactory=new e,this.createTextareaUI(t)}return t.prototype.subscribe=function(t){this.subscribers.push(t)},t.prototype.createTextareaUI=function(t,e){var n=this;void 0===e&&(e=""),this.textarea=this.elementFactory.getHTMLElement("textarea"),this.textarea.className="textarea",this.textarea.innerText=e,this.textarea.addEventListener("input",(function(t){n.subscribers.forEach((function(e){return e(t)}))})),t.appendChild(this.textarea)},t}(),i=function(){function n(t){this.subscribers=[],this.elementFactory=new e,this.createContextMenuUI(t)}return n.prototype.subscribe=function(t){this.subscribers.push(t)},n.prototype.hideMenu=function(){this.menu&&(this.menu.remove(),this.menu.innerHTML="")},n.prototype.createContextMenuUI=function(t){this.addEventHandlers(t)},n.prototype.createItems=function(){this.menu.appendChild(this.createItem("Paste",t.PasteCommand)),this.menu.appendChild(this.createItem("Copy",t.CopyCommand)),this.menu.appendChild(this.createItem("Clear - CTRL + D",t.ClearCommand)),this.menu.appendChild(this.createItem("Undo - CTRL + U",t.UndoCommand)),this.menu.appendChild(this.createItem("Rollback all - CTRL + R",t.RollbackAllCommand))},n.prototype.createItem=function(t,e){var n=this,o=document.createElement("button");return o.classList.add("context-menu__item"),o.setAttribute("data-action",e.toString()),o.innerText=t,o.addEventListener("click",(function(){n.subscribers.forEach((function(t){return t(e)}))})),o},n.prototype.addEventHandlers=function(t){var e=this;t.addEventListener("contextmenu",(function(n){e.hideMenu(),e.menu=e.elementFactory.getHTMLElement("contextmenu"),e.menu.style.top="".concat(n.clientY,"px"),e.menu.style.left="".concat(n.clientX,"px"),e.createItems(),t.appendChild(e.menu),n.preventDefault()})),document.addEventListener("click",(function(){e.hideMenu()}))},n}();!function(t){t[t.Removed=0]="Removed",t[t.Added=1]="Added"}(n||(n={}));var a,s=function(){function t(t){this.elementFactory=new e,this.createHistoryUI(t)}return t.prototype.setHistory=function(t){this.handleHistory(t)},t.prototype.createHistoryUI=function(t){this.historyElement=this.elementFactory.getHTMLElement("history"),this.historyElement.innerHTML="Commands history:",t.appendChild(this.historyElement);var e=document.createElement("ul");e.classList.add("history__list"),this.historyElement.appendChild(e)},t.prototype.handleHistory=function(t){var e=this;t.subscribe((function(t){var n=t.command,o=t.status;e.updateHistoryUI(n,o)}))},t.prototype.updateHistoryUI=function(t,e){var o=this.historyElement.getElementsByClassName("history__list").item(0);if(e===n.Added){var r=document.createElement("li");r.classList.add("history__item","history__item--added"),r.innerText="command backup: ".concat(t.backup.content),o.appendChild(r)}else e===n.Removed&&o.lastElementChild&&(o.lastElementChild.classList.add("history__item--removed"),o.lastElementChild.addEventListener("animationend",(function(){o.removeChild(o.lastElementChild)})))},t}(),c=function(){function t(t,e,n){this.editor=t,this.textareaUI=e,this.history=n}return t.prototype.saveBackup=function(){this.backup=this.editor.createSnapshot()},t.prototype.undo=function(){this.backup.restore&&this.backup.restore()},t}(),u=(a=function(t,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},a(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),h=function(t){function e(e,n,o){return t.call(this,e,n,o)||this}return u(e,t),e.prototype.execute=function(){return this.saveBackup(),!!this.textareaUI.textarea.value&&(this.textareaUI.textarea.value="",!0)},e}(c),d=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),p=function(t){function e(e,n,o){return t.call(this,e,n,o)||this}return d(e,t),e.prototype.execute=function(){return navigator.clipboard.writeText(this.textareaUI.textarea.value),!1},e}(c),l=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=function(t){function e(e,n,o){return t.call(this,e,n,o)||this}return l(e,t),e.prototype.execute=function(){var t=this,e=setInterval((function(){var n=t.history.pop();n&&n.undo(),t.history.isEmpty()&&clearInterval(e)}),100);return!1},e}(c),f=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=function(t){function e(e,n,o){return t.call(this,e,n,o)||this}return f(e,t),e.prototype.execute=function(){var t=this.history.pop();return t&&t.undo(),!1},e}(c),v=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=function(t){function e(e,n,o){return t.call(this,e,n,o)||this}return v(e,t),e.prototype.execute=function(){return this.saveBackup(),this.textareaUI.textarea.value!==this.editor.content&&(this.editor.content=this.textareaUI.textarea.value,!0)},e}(c),C=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),x=function(t){function e(e,n,o){return t.call(this,e,n,o)||this}return C(e,t),e.prototype.execute=function(){var t=this;return this.saveBackup(),navigator.clipboard.readText().then((function(e){var n=t.textareaUI.textarea,o=n.selectionStart,r=n.selectionEnd;t.textareaUI.textarea.setRangeText(e,o,r,"select")})),!0},e}(c),_=function(){function e(t,e,n){this.editor=t,this.textareaUI=e,this.history=n}return e.prototype.getCommand=function(e){switch(e){case t.ClearCommand:return new h(this.editor,this.textareaUI,this.history);case t.UndoCommand:return new y(this.editor,this.textareaUI,this.history);case t.CopyCommand:return new p(this.editor,this.textareaUI,this.history);case t.RollbackAllCommand:return new m(this.editor,this.textareaUI,this.history);case t.UpdateContentCommand:return new b(this.editor,this.textareaUI,this.history);case t.PasteCommand:return new x(this.editor,this.textareaUI,this.history);default:throw new Error("Command doesn't exist.")}},e}(),I=function(){function t(){this.history=[],this.subscribers=[]}return t.prototype.push=function(t){this.history.push(t),this.notify(t,n.Added)},t.prototype.pop=function(){var t=this.history.pop();return this.notify(t,n.Removed),t},t.prototype.isEmpty=function(){return 0===this.history.length},t.prototype.subscribe=function(t){this.subscribers.push(t)},t.prototype.notify=function(t,e){var n={command:t,status:e};this.subscribers.forEach((function(t){t(n)}))},t}(),w=function(){function t(){this.commandHistory=new I}return t.prototype.send=function(t){t.execute()&&this.commandHistory.push(t)},t}(),E=function(){function t(t,e){this.textareaUI=t,this.content=e||""}return t.prototype.restore=function(){this.textareaUI.textarea.value=this.content},t}(),U=function(){function e(t,e){this.commandInvoker=t,this.commandFactory=e}return e.prototype.handleKeyboardEvent=function(e){var n;switch(e.key){case"r":e.ctrlKey&&(e.preventDefault(),n=this.commandFactory.getCommand(t.RollbackAllCommand));break;case"u":e.ctrlKey&&(e.preventDefault(),n=this.commandFactory.getCommand(t.UndoCommand));break;case"d":e.ctrlKey&&(e.preventDefault(),n=this.commandFactory.getCommand(t.ClearCommand))}n&&this.commandInvoker.send(n)},e}(),k=function(){function e(){}return e.prototype.initApp=function(){this.root=document.getElementById("root"),this.toolsUI=new o(this.root),this.textareaUI=new r(this.root),this.menuUI=new i(this.root),this.historyUI=new s(this.root),this.commandInvoker=new w,this.commandFactory=new _(this,this.textareaUI,this.commandInvoker.commandHistory),this.shortcutsHandler=new U(this.commandInvoker,this.commandFactory),this.historyUI.setHistory(this.commandInvoker.commandHistory),this.handleToolbarActions(),this.handleTextarea(),this.handleShortcuts(),this.handleContextMenuActions()},e.prototype.createSnapshot=function(){return new E(this.textareaUI,this.content)},e.prototype.handleToolbarActions=function(){var t=this;this.toolsUI.subscribe((function(e){var n=t.commandFactory.getCommand(e);t.commandInvoker.send(n)}))},e.prototype.handleContextMenuActions=function(){var t=this;this.menuUI.subscribe((function(e){var n=t.commandFactory.getCommand(e);t.commandInvoker.send(n)}))},e.prototype.handleTextarea=function(){var e=this;this.textareaUI.subscribe((function(){var n=e.commandFactory.getCommand(t.UpdateContentCommand);e.commandInvoker.send(n)}))},e.prototype.handleShortcuts=function(){var t=this;this.root.addEventListener("keydown",(function(e){t.shortcutsHandler.handleKeyboardEvent(e)}))},e}();window.addEventListener("DOMContentLoaded",(function(){(new k).initApp()}))})();